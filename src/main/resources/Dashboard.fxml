<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.image.*?>
<?import javafx.scene.text.*?>

<StackPane xmlns:fx="http://javafx.com/fxml/1"
           xmlns="http://javafx.com/javafx/17"
           fx:controller="controllers.DashboardController"
           stylesheets="@style.css"
           prefWidth="1200" prefHeight="700">

    <!-- Image de fond -->
    <ImageView fitWidth="1200" fitHeight="700" preserveRatio="false">
        <Image url="@/images/BackgroundBack.png"/>
    </ImageView>

    <!-- Contenu principal -->
    <BorderPane>
        <!-- En-tête avec titre et bouton déconnexion -->
        <top>
            <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-padding: 10 15; -fx-background-color: rgba(46, 125, 50, 0.8);">
                <Label text="DigiFarm" style="-fx-text-fill: white; -fx-font-size: 22px; -fx-font-weight: bold; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.7), 3, 0, 0, 1);"/>
                <Region HBox.hgrow="ALWAYS" />
                <Label fx:id="welcomeLabel" style="-fx-text-fill: white; -fx-font-size: 13px; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.5), 2, 0, 0, 1);"/>
                <Button fx:id="logoutButton" text="Déconnexion" onAction="#handleLogout"
                        styleClass="logout-button"/>
            </HBox>
        </top>

        <!-- Conteneur principal avec menu latéral et zone de contenu -->
        <center>
            <HBox>
                <!-- Menu latéral avec accordéon -->
                <VBox styleClass="sidebar" prefWidth="250">
                    <ScrollPane fitToWidth="true" styleClass="sidebar-scroll">
                        <VBox fx:id="sidebarContent" spacing="5">
                            <!-- Gestion des Utilisateurs (affichage direct) -->
                            <Button text="Gestion Utilisateurs" onAction="#showGestionAdmin" styleClass="sidebar-button"/>

                            <!-- Gestion Étude (avec sous-menu) -->
                            <VBox styleClass="sidebar-section">
                                <Button text="Gestion Étude" styleClass="sidebar-button" onAction="#toggleEtudeSubMenu"/>
                                <VBox fx:id="etudeSubMenu" styleClass="sub-menu" visible="false" managed="false">
                                    <Button text="Projets" onAction="#showGestionEtude" styleClass="submenu-button"/>
                                    <Button text="Rapports" onAction="#showGestionEtude" styleClass="submenu-button"/>
                                    <Button text="Données" onAction="#showGestionEtude" styleClass="submenu-button"/>
                                </VBox>
                            </VBox>

                            <!-- Gestion Animaux (avec sous-menu) -->
                            <VBox styleClass="sidebar-section">
                                <Button text="Gestion Animaux" styleClass="sidebar-button" onAction="#toggleAnimauxSubMenu"/>
                                <VBox fx:id="animauxSubMenu" styleClass="sub-menu" visible="false" managed="false">
                                    <Button text="Troupeau" onAction="#showGestionAnimaux" styleClass="submenu-button"/>
                                    <Button text="Santé" onAction="#showGestionAnimaux" styleClass="submenu-button"/>
                                    <Button text="Reproduction" onAction="#showGestionAnimaux" styleClass="submenu-button"/>
                                    <Button text="Alimentation" onAction="#showGestionAnimaux" styleClass="submenu-button"/>
                                </VBox>
                            </VBox>

                            <!-- Gestion Abonnement (avec sous-menu) -->
                            <VBox styleClass="sidebar-section">
                                <Button text="Gestion Abonnement" styleClass="sidebar-button" onAction="#toggleAbonnementSubMenu"/>
                                <VBox fx:id="abonnementSubMenu" styleClass="sub-menu" visible="false" managed="false">
                                    <Button text="Plans" onAction="#showGestionAbonnement" styleClass="submenu-button"/>
                                    <Button text="Clients" onAction="#showGestionAbonnement" styleClass="submenu-button"/>
                                    <Button text="Facturation" onAction="#showGestionAbonnement" styleClass="submenu-button"/>
                                </VBox>
                            </VBox>

                            <!-- Gestion Machine (avec sous-menu) -->
                            <VBox styleClass="sidebar-section">
                                <Button text="Gestion Machine" styleClass="sidebar-button" onAction="#toggleMachineSubMenu"/>
                                <VBox fx:id="machineSubMenu" styleClass="sub-menu" visible="false" managed="false">
                                    <Button text="Inventaire" onAction="#showGestionMachine" styleClass="submenu-button"/>
                                    <Button text="Maintenance" onAction="#showGestionMachine" styleClass="submenu-button"/>
                                    <Button text="Utilisation" onAction="#showGestionMachine" styleClass="submenu-button"/>
                                </VBox>
                            </VBox>

                            <!-- Gestion Stock (avec sous-menu) -->
                            <VBox styleClass="sidebar-section">
                                <Button text="Gestion Stock" styleClass="sidebar-button" onAction="#toggleStockSubMenu"/>
                                <VBox fx:id="stockSubMenu" styleClass="sub-menu" visible="false" managed="false">
                                    <Button text="Produits" onAction="#showGestionStock" styleClass="submenu-button"/>
                                    <Button text="Fournisseurs" onAction="#showGestionStock" styleClass="submenu-button"/>
                                    <Button text="Commandes" onAction="#showGestionStock" styleClass="submenu-button"/>
                                    <Button text="Inventaire" onAction="#showGestionStock" styleClass="submenu-button"/>
                                </VBox>
                            </VBox>
                        </VBox>
                    </ScrollPane>
                </VBox>

                <!-- Zone de contenu principal -->
                <VBox HBox.hgrow="ALWAYS" style="-fx-padding: 15;">
                    <!-- VBox invisible pour compatibilité avec le contrôleur existant -->
                    <VBox fx:id="entityList" managed="false" visible="false" opacity="0" maxHeight="0"/>

                    <!-- Zone de contenu principale visible -->
                    <StackPane fx:id="entityContentPane" VBox.vgrow="ALWAYS" style="-fx-background-color: rgba(255, 255, 255, 0.6); -fx-background-radius: 10; -fx-padding: 15;">
                    </StackPane>
                </VBox>
            </HBox>
        </center>
    </BorderPane>
</StackPane>